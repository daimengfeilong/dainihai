function UploadPic(){this.sw=0,this.sh=0,this.tw=0,this.th=0,this.scale=0,this.maxWidth=0,this.maxHeight=0,this.maxSize=0,this.fileSize=0,this.fileDate=null,this.fileType="",this.fileName="",this.input=null,this.canvas=null,this.mime={},this.type="",this.callback=function(){},this.loading=function(){}}var Orientation=null;UploadPic.prototype.init=function(t){this.maxWidth=t.maxWidth||800,this.maxHeight=t.maxHeight||600,this.maxSize=t.maxSize||5242880,this.input=t.input,this.mime={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",bmp:"image/bmp"},this.callback=t.callback||function(){},this.loading=t.loading||function(){},this._addEvent()},UploadPic.prototype._addEvent=function(){function t(t){i._handelSelectFile(t)}var i=this;this.input.addEventListener("change",t,!1)},UploadPic.prototype._handelSelectFile=function(t){var i=t.target.files[0];return this.type=i.type,this.type||(this.type=this.mime[i.name.match(/\.([^\.]+)$/i)[1]]),/image.(png|jpg|jpeg|bmp)/.test(this.type)?i.size>this.maxSize?($("#dialog_text").val("选择文件大于"+this.maxSize/1024/1024+"M，请重新选择"),void $("#dialog2").show()):(EXIF.getData(i,function(){EXIF.getAllTags(this),Orientation=EXIF.getTag(this,"Orientation")}),this.fileName=i.name,this.fileSize=i.size,this.fileType=this.type,this.fileDate=i.lastModifiedDate,void this._readImage(i)):void ShowMsg("选择的文件类型不是图片")},UploadPic.prototype._readImage=function(t){function i(t){e._createImage(t)}var e=this;this.loading(),this._getURI(t,i)},UploadPic.prototype._getURI=function(t,i){function e(){var t=/^data:base64,/,e=this.result+"";t.test(e)&&(e=e.replace(t,"data:"+h.mime[h.fileType]+";base64,")),i&&i(e)}var a=new FileReader,h=this;return a.onload=e,a.readAsDataURL(t),!1},UploadPic.prototype._createImage=function(t){function i(){a._drawImage(this)}var e=new Image,a=this;e.onload=i,e.src=t},UploadPic.prototype._drawImage=function(t,i){this.sw=t.width,this.sh=t.height,this.tw=t.width,this.th=t.height,this.scale=(this.tw/this.th).toFixed(2),this.sw>this.maxWidth&&(this.sw=this.maxWidth,this.sh=Math.round(this.sw/this.scale)),this.sh>this.maxHeight&&(this.sh=this.maxHeight,this.sw=Math.round(this.sh*this.scale)),this.canvas=document.createElement("canvas");var e=this.canvas.getContext("2d");this.canvas.width=this.sw,this.canvas.height=this.sh,e.drawImage(t,0,0,t.width,t.height,0,0,this.sw,this.sh);var a=null;new MegaPixImage(t).render(this.canvas,{maxWidth:this.sw,maxHeight:this.sh,quality:.1,orientation:Orientation}),a=this.canvas.toDataURL(this.type),this.callback(a),e.clearRect(0,0,this.tw,this.th),this.canvas.width=0,this.canvas.height=0,this.canvas=null};