function userScore(){var e=urlLink+"/web/user_profile/score_info";xmlHttpRequest(null,e,getScoreInfo,"get")}function getScoreInfo(e){$("#totalPoints").text(e.data.int32_cumulative),$("#availablePoints").text(e.data.int32_available)}function reloadScores(){console.log("reloading...."),$(".pointsRecordDetail dl:not(:first)").remove(),nowMonth=null,nowYear=null,_currPage=0,_pages=0,getScores(0)}function getScores(e){var e=e||0,o=urlLink+"/web/user_profile/score_details",t="?page="+e;xmlHttpRequest(t,o,getScoreDetails,"get")}function getScoreDetails(e,o){LoadingOver();var t=JSON.parse(severResponse);switch(t.code){case 0:if(0==e.data.int32_total)return $(".noRecord").show(),void $("#wrapper").hide();_pages=Math.floor(e.data.int32_total/10);var r=e.data.struct_score_info,a=r[0].string_date.split("-");nowYear=a[0][2]+a[0][3],$.each(r,function(e,o){var t=o.string_date.split("-"),r=t[0].split(""),a=r[2]+r[3],n=t[1],s=t[2],i=o.string_reason,l=o.string_value,c=$(".detailTmp:first").clone(!0).removeClass("hide detailTmp").addClass("records");c.find(".year").text(a),c.find(".month").text(n),c.find(".day").text(s),c.find(".reason").text(i),c.find(".value").text(l),"-"===l[0]&&c.find(".value").css("color","#fc335e"),$(".points").append(c)}),$.each($(".records"),function(e,o){var t=$(o).find(".year").text(),r=$(o).find(".month").text();if(t==nowYear){$(o).next(".records");$(o).find(".recordDetailRound").removeClass("roundBig").addClass("roundSmall").find("span").hide(),r==nowMonth?($(o).find("dt").hide(),$(o).css({"padding-top":0,"padding-bottom":0}),$(o).prev(".records").css("padding-bottom","0")):nowMonth=r}else nowYear=t,nowMonth=r}),addHeight(),setTimeout(function(){canNextPage=!1,canReload=!1,myScroll.refresh()},200);break;case-10004:case-10003:session_expired(t.msg);break;case 404:case-10002:logout();break;default:top_meassage(t.msg),show_topmessage()}}function addHeight(){for(var e=$("#wrapper").height(),o=$("#wrapper").outerHeight(),t=$(".points dl").length-1,r=0,a=t-1;a>0;a--)r+=$(".points dl").eq(a).outerHeight();r<o?$(".points").css({height:e+"px","padding-bottom":"10px"}):$(".points").css("height","")}var _currPage=0,_pages=0,nowYear=null,nowMonth=null,myScroll=null,canReload=!1,canNextPage=!1;$(function(){document.querySelector("#wrapper").addEventListener("touchmove",function(e){e.preventDefault()},!1),myScroll=new IScroll("#wrapper",{mouseWheel:!0,probeType:2,vScrollbar:!1}),myScroll.on("scroll",function(){var e=-1*this.y,o=$("#wrapper").height(),t=$(".points").outerHeight(),r=-parseInt($(".loadMore").css("bottom"));e+o-r>t&&(_currPage<_pages&&($(".loadMore").show(),canNextPage=!0),_currPage==_pages&&$(".loadMore").hide()),e<-r&&-1==this.directionY&&(canReload=!0)}),myScroll.on("scrollEnd",function(){if(canReload&&canNextPage)return void reloadScores();canReload&&(userScore(),reloadScores()),canNextPage&&(console.log("loadMore..."),_currPage++,getScores(_currPage))}),userScore(),getScores(_currPage)});