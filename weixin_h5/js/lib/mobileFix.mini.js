function JPEGEncoder(r){function a(r){for(var a=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],e=0;e<64;e++){var t=R((a[e]*r+50)/100);t<1?t=1:t>255&&(t=255),U[_[e]]=t}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var i=R((n[o]*r+50)/100);i<1?i=1:i>255&&(i=255),M[_[o]]=i}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],c=0,h=0;h<8;h++)for(var v=0;v<8;v++)k[c]=1/(U[_[c]]*f[h]*f[v]*8),p[c]=1/(M[_[c]]*f[h]*f[v]*8),c++}function e(r,a){for(var e=0,t=0,n=new Array,o=1;o<=16;o++){for(var i=1;i<=r[o];i++)n[a[t]]=[],n[a[t]][0]=e,n[a[t]][1]=o,t++,e++;e*=2}return n}function t(){b=e(q,G),L=e(z,F),y=e(J,S),I=e(K,Q)}function n(){for(var r=1,a=2,e=1;e<=15;e++){for(var t=r;t<a;t++)C[32767+t]=e,j[32767+t]=[],j[32767+t][1]=e,j[32767+t][0]=t;for(var n=-(a-1);n<=-r;n++)C[32767+n]=e,j[32767+n]=[],j[32767+n][1]=e,j[32767+n][0]=a-1+n;r<<=1,a<<=1}}function o(){for(var r=0;r<256;r++)B[r]=19595*r,B[r+256>>0]=38470*r,B[r+512>>0]=7471*r+32768,B[r+768>>0]=-11059*r,B[r+1024>>0]=-21709*r,B[r+1280>>0]=32768*r+8421375,B[r+1536>>0]=-27439*r,B[r+1792>>0]=-5329*r}function i(r){for(var a=r[0],e=r[1]-1;e>=0;)a&1<<e&&(P|=1<<H),e--,--H<0&&(255==P?(f(255),f(0)):f(P),H=7,P=0)}function f(r){E.push(N[r])}function c(r){f(r>>8&255),f(255&r)}function h(r,a){var e,t,n,o,i,f,c,h,v,s=0;for(v=0;v<8;++v){e=r[s],t=r[s+1],n=r[s+2],o=r[s+3],i=r[s+4],f=r[s+5],c=r[s+6],h=r[s+7];var u=e+h,d=e-h,g=t+c,w=t-c,l=n+f,m=n-f,b=o+i,L=o-i,y=u+b,I=u-b,A=g+l,R=g-l;r[s]=y+A,r[s+4]=y-A;var U=.707106781*(R+I);r[s+2]=I+U,r[s+6]=I-U,y=L+m,A=m+w,R=w+d;var M=.382683433*(y-R),k=.5411961*y+M,p=1.306562965*R+M,j=.707106781*A,C=d+j,x=d-j;r[s+5]=x+k,r[s+3]=x-k,r[s+1]=C+p,r[s+7]=C-p,s+=8}for(s=0,v=0;v<8;++v){e=r[s],t=r[s+8],n=r[s+16],o=r[s+24],i=r[s+32],f=r[s+40],c=r[s+48],h=r[s+56];var E=e+h,P=e-h,H=t+c,O=t-c,T=n+f,W=n-f,N=o+i,B=o-i,_=E+N,q=E-N,G=H+T,J=H-T;r[s]=_+G,r[s+32]=_-G;var S=.707106781*(J+q);r[s+16]=q+S,r[s+48]=q-S,_=B+W,G=W+O,J=O+P;var z=.382683433*(_-J),F=.5411961*_+z,K=1.306562965*J+z,Q=.707106781*G,V=P+Q,X=P-Q;r[s+40]=X+F,r[s+24]=X-F,r[s+8]=V+K,r[s+56]=V-K,s++}var Y;for(v=0;v<64;++v)Y=r[v]*a[v],D[v]=Y>0?Y+.5|0:Y-.5|0;return D}function v(){c(65504),c(16),f(74),f(70),f(73),f(70),f(0),f(1),f(1),f(0),c(1),c(1),f(0),f(0)}function s(r,a){c(65472),c(17),f(8),c(a),c(r),f(3),f(1),f(17),f(0),f(2),f(17),f(1),f(3),f(17),f(1)}function u(){c(65499),c(132),f(0);for(var r=0;r<64;r++)f(U[r]);f(1);for(var a=0;a<64;a++)f(M[a])}function d(){c(65476),c(418),f(0);for(var r=0;r<16;r++)f(q[r+1]);for(var a=0;a<=11;a++)f(G[a]);f(16);for(var e=0;e<16;e++)f(J[e+1]);for(var t=0;t<=161;t++)f(S[t]);f(1);for(var n=0;n<16;n++)f(z[n+1]);for(var o=0;o<=11;o++)f(F[o]);f(17);for(var i=0;i<16;i++)f(K[i+1]);for(var h=0;h<=161;h++)f(Q[h])}function g(){c(65498),c(12),f(3),f(1),f(0),f(2),f(17),f(3),f(17),f(0),f(63),f(0)}function w(r,a,e,t,n){var o,f=n[0],c=n[240];for(var v=h(r,a),s=0;s<64;++s)x[_[s]]=v[s];var u=x[0]-e;e=x[0],0==u?i(t[0]):(o=32767+u,i(t[C[o]]),i(j[o]));for(var d=63;d>0&&0==x[d];d--);if(0==d)return i(f),e;for(var g,w=1;w<=d;){for(var l=w;0==x[w]&&w<=d;++w);var m=w-l;if(m>=16){g=m>>4;for(var b=1;b<=g;++b)i(c);m&=15}o=32767+x[w],i(n[(m<<4)+C[o]]),i(j[o]),w++}return 63!=d&&i(f),e}function l(){for(var r=String.fromCharCode,a=0;a<256;a++)N[a]=r(a)}function m(r){if(r<=0&&(r=1),r>100&&(r=100),A!=r){var e=0;e=r<50?Math.floor(5e3/r):Math.floor(200-2*r),a(e),A=r}}var b,L,y,I,A,R=(Math.round,Math.floor),U=new Array(64),M=new Array(64),k=new Array(64),p=new Array(64),j=new Array(65535),C=new Array(65535),D=new Array(64),x=new Array(64),E=[],P=0,H=7,O=new Array(64),T=new Array(64),W=new Array(64),N=new Array(256),B=new Array(2048),_=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],G=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],S=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],z=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],K=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Q=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(r,a,e){var t=(new Date).getTime();a&&m(a),E=new Array,P=0,H=7,c(65496),v(),u(),s(r.width,r.height),d(),g();var n=0,o=0,f=0;P=0,H=7,this.encode.displayName="_encode_";for(var h,l,A,R,U,M,j,C,D,x=r.data,N=r.width,_=r.height,q=4*N,G=0;G<_;){for(h=0;h<q;){for(U=q*G+h,M=U,j=-1,C=0,D=0;D<64;D++)C=D>>3,j=4*(7&D),M=U+C*q+j,G+C>=_&&(M-=q*(G+1+C-_)),h+j>=q&&(M-=h+j-q+4),l=x[M++],A=x[M++],R=x[M++],O[D]=(B[l]+B[A+256>>0]+B[R+512>>0]>>16)-128,T[D]=(B[l+768>>0]+B[A+1024>>0]+B[R+1280>>0]>>16)-128,W[D]=(B[l+1280>>0]+B[A+1536>>0]+B[R+1792>>0]>>16)-128;n=w(O,k,n,b,y),o=w(T,p,o,L,I),f=w(W,p,f,L,I),h+=32}G+=8}if(H>=0){var J=[];J[1]=H+1,J[0]=(1<<H+1)-1,i(J)}if(c(65497),e){for(var S=E.length,z=new Uint8Array(S),F=0;F<S;F++)z[F]=E[F].charCodeAt();E=[];(new Date).getTime();return z}var K="data:image/jpeg;base64,"+btoa(E.join(""));E=[];(new Date).getTime();return K},function(){(new Date).getTime();r||(r=50),l(),t(),n(),o(),m(r),(new Date).getTime()}()}!function(){function r(r){var a=r.naturalWidth;if(a*r.naturalHeight>1048576){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");return t.drawImage(r,1-a,0),0===t.getImageData(0,0,1,1).data[3]}return!1}function a(r,a,e){var t=document.createElement("canvas");t.width=1,t.height=e;var n=t.getContext("2d");n.drawImage(r,0,0);for(var o=n.getImageData(0,0,1,e).data,i=0,f=e,c=e;c>i;){0===o[4*(c-1)+3]?f=c:i=c,c=f+i>>1}var h=c/e;return 0===h?1:h}function e(r,a,e){var n=document.createElement("canvas");return t(r,n,a,e),n.toDataURL("image/jpeg",a.quality||.8)}function t(e,t,o,i){var f=e.naturalWidth,c=e.naturalHeight;if(f+c){var h=o.width,v=o.height,s=t.getContext("2d");s.save(),n(t,s,h,v,o.orientation);r(e)&&(f/=2,c/=2);var u=1024,d=document.createElement("canvas");d.width=d.height=u;for(var g=d.getContext("2d"),w=i?a(e,f,c):1,l=Math.ceil(u*h/f),m=Math.ceil(u*v/c/w),b=0,L=0;b<c;){for(var y=0,I=0;y<f;)g.clearRect(0,0,u,u),g.drawImage(e,-y,-b),s.drawImage(d,0,0,u,u,I,L,l,m),y+=u,I+=l;b+=u,L+=m}s.restore(),d=g=null}}function n(r,a,e,t,n){switch(n){case 5:case 6:case 7:case 8:r.width=t,r.height=e;break;default:r.width=e,r.height=t}switch(n){case 2:a.translate(e,0),a.scale(-1,1);break;case 3:a.translate(e,t),a.rotate(Math.PI);break;case 4:a.translate(0,t),a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI),a.translate(0,-t);break;case 7:a.rotate(.5*Math.PI),a.translate(e,-t),a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-e,0)}}function o(r){if(window.Blob&&r instanceof Blob){if(!i)throw Error("No createObjectURL function found to create blob url");var a=new Image;a.src=i.createObjectURL(r),this.blob=r,r=a}if(!r.naturalWidth&&!r.naturalHeight){var e=this;r.onload=r.onerror=function(){var r=e.imageLoadListeners;if(r){e.imageLoadListeners=null;for(var a=0,t=r.length;a<t;a++)r[a]()}},this.imageLoadListeners=[]}this.srcImage=r}var i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o.prototype.render=function(r,a,n){if(this.imageLoadListeners){var o=this;return void this.imageLoadListeners.push(function(){o.render(r,a,n)})}a=a||{};var f=this.srcImage.naturalWidth,c=this.srcImage.naturalHeight,h=a.width,v=a.height,s=a.maxWidth,u=a.maxHeight,d=!this.blob||"image/jpeg"===this.blob.type;h&&!v?v=c*h/f<<0:v&&!h?h=f*v/c<<0:(h=f,v=c),s&&h>s&&(h=s,v=c*h/f<<0),u&&v>u&&(v=u,h=f*v/c<<0);var g={width:h,height:v};for(var w in a)g[w]=a[w];var l=r.tagName.toLowerCase();"img"===l?r.src=e(this.srcImage,g,d):"canvas"===l&&t(this.srcImage,r,g,d),"function"==typeof this.onrender&&this.onrender(r),n&&n(),this.blob&&(this.blob=null,i.revokeObjectURL(this.srcImage.src))},"function"==typeof define&&define.amd?define([],function(){return o}):this.MegaPixImage=o}();